{
  "id": "yy1",
  "title": "Build fo-experience.tsx state machine with skip logic",
  "description": "## Objective\n\nCreate the main FOExperience state machine component for FO-11 with the 2-3 discovery step flow and skip logic for step 5.\n\n## Spec Reference\n\n**Spec:** docs/projects/2026-02-11-fo-11/2026-02-11-fo-11-spec.md — Sections: \"Flow\", \"Data Flow\", \"Heart Animation Transitions\"\n\n## Scope\n\n**Files to create:**\n- app/fo-11/components/fo-experience.tsx\n\n## Implementation\n\nThis is the most complex component. Reference app/fo-10/components/fo-experience.tsx as base but with significant changes.\n\n1. State machine has steps 0-13 (not 0-14 like FO-10):\n   - 0-2: Welcome (same as FO-10)\n   - 3: Familiarity (cosmetic — value stored but not passed to agents)\n   - 4: Goal (same as FO-10 step 4)\n   - 5: Context (LLM question + fragments, OR silently skipped)\n   - 6: Tone (LLM question + single-word chips)\n   - 7: Affirmation generation loading\n   - 8: Card review\n   - 9: Summary\n   - 10-12: Background, notifications, paywall\n   - 13: Completion\n\n2. After step 4 (goal):\n   - Show heart animation \"Thank you for sharing, [name]...\"\n   - Call generateDiscoveryStep(5, context) during animation\n   - If response.skip === true: call generateDiscoveryStep(6, context) and advance to step 6\n   - If response.skip === false: store question + chips, advance to step 5\n\n3. After step 5 (context, if not skipped):\n   - Show heart animation \"Thank you for sharing, [name]...\"\n   - Call generateDiscoveryStep(6, context) during animation\n   - Advance to step 6\n\n4. After step 6 (tone):\n   - Show heart animation \"You have been doing great, [name]! We are creating your personalized affirmations.\"\n   - Generate affirmations\n\n5. State must track:\n   - step5Skipped: boolean — whether step 5 was skipped\n   - step5Data / step6Data: { question, initialChips, expandedChips } | null\n   - All the same affirmation/card/summary state as FO-10\n\n6. The exchanges array has 2 or 3 entries depending on skip\n7. Familiarity is NOT passed to generateDiscoveryStep or affirmation generation\n\n## Tests\n\n1. TypeCheck — component compiles\n2. DevServer — npm run dev starts without errors, /fo-11 page loads\n\nRun: npx tsc --noEmit\n\nDo NOT close until tests pass.",
  "status": "open",
  "priority": 2,
  "type": "task",
  "owner": "morten@elk.dk",
  "parent": "69h",
  "acceptance_criteria": "npx tsc --noEmit passes and npm run dev builds successfully",
  "created_by": "morten@elk.dk",
  "created_at": "2026-02-11T13:34:55.9638974Z",
  "updated_at": "2026-02-11T13:34:55.9638974Z"
}