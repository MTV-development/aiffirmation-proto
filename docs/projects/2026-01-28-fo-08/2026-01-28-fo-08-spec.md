# FO-08 Specification

**Created:** 2026-01-28
**Status:** Draft

## Overview

FO-08 combines the best of FO-06 and FO-07:
- **FO-07's discovery framework** (5 Dimensions for deep understanding)
- **FO-06's fragment mechanics** (sentence starters that encourage self-expression)
- **NEW: Hybrid fragments** that suggest content direction while inviting personal completion

### The Problem We're Solving

| Approach | Strength | Weakness |
|----------|----------|----------|
| **Chips** ("work stress", "self-doubt") | Proposes answers, normalizes feelings, low effort | User doesn't express in their own words |
| **Pure fragments** ("I keep worrying that...") | Encourages authentic expression | No content guidance, user may struggle |

**FO-08's solution:** Hybrid fragments that suggest a direction while remaining open-ended.

## Core Concept

> "Suggest the direction, invite the completion"

Hybrid fragments give users:
1. **Normalization** — "others experience this too"
2. **Direction** — "maybe this resonates with you"
3. **Space for authenticity** — "but tell me YOUR specific version"

### The Hybrid Fragment Principle

| Type | Example | Problem |
|------|---------|---------|
| Chip (closed) | "self-doubt" | Complete answer, no personal expression |
| Pure fragment (structure only) | "I keep worrying that..." | No content hint, too open |
| **Hybrid fragment** | "I keep doubting whether I'm..." | Suggests self-doubt direction, user completes *what* they doubt |

The magic is in the **specificity of the incompleteness**:
- "I keep worrying that..." → too open (what direction?)
- "I keep worrying that I'm not good enough" → too closed (nothing to add)
- "I keep worrying that I'm not..." → suggests direction, invites completion

## Technical Approach

**Technical base:** FO-06 (has fragment mechanics already built)

**Prompt/framework base:** FO-07 (5 Dimensions, reflective statements, tone)

**Key changes from FO-06:**
1. Replace discovery prompt with FO-07's framework + hybrid fragment generation
2. Show 8 fragments immediately (remove "Inspiration" link), 15 via "More"
3. Use FO-07's affirmation-review (thumbs up/down) instead of swipe
4. Use FO-07's heart animation
5. No progress bar
6. Use FO-07's affirmation and summary agents

## User Flow

### Welcome Phase (Same as FO-07)

| Step | Screen | Description |
|------|--------|-------------|
| 0 | Welcome | "The way you speak to yourself becomes the way you live!" |
| 1 | Name | "What should we call you?" |
| 2 | Personalized Welcome | "Welcome, {name}! Let us get to know you..." |
| 3 | Familiarity | "How familiar are you with affirmations?" (New / Some / Very) |
| 4 | Topics | Multi-select chips for areas of focus |

### Discovery Phase (Modified)

| Aspect | FO-08 Approach |
|--------|----------------|
| Framework | **FO-07's 5 Dimensions**: Emotional Baseline, Inner Dialogue, Needs & Longings, Believability Threshold, Life Context |
| Reflective statements | Separate from question (FO-07 style) |
| Tone | Warm, calm, supportive (FO-07) |
| Input | **Hybrid fragments** shown immediately |
| Screens | 2-5 dynamic screens |

**Fragment mechanics:**
- **8 initial fragments** visible immediately (not hidden)
- **15 expanded fragments** revealed via "More" button
- **Total: 23 fragments** per screen to maximize chance of resonance
- All fragments are **hybrid**: suggest content direction + invite completion
- Clicking a fragment: removes "...", appends to text area, focuses cursor
- User completes the thought in their own words

### Affirmation Generation

| Aspect | FO-08 Approach |
|--------|----------------|
| Count | 10 affirmations |
| Generation | Single call (no feedback loop) |
| Prompts | Same as FO-07 (which matches FO-04) |

### Affirmation Review

| Aspect | FO-08 Approach |
|--------|----------------|
| Selection UI | Thumbs up/down buttons (FO-07) |
| Requirement | Must rate all 10 before Continue enables |
| Summary | AI-generated summary at top of review screen |

### Post-Review Phase (Same as FO-07)

| Step | Screen |
|------|--------|
| Background | Visual personalization mockup |
| Notifications | Reminder preferences mockup |
| Paywall | Premium offering mockup |
| Completion | Shows liked affirmations |

## UI/UX Details

| Aspect | FO-08 |
|--------|-------|
| Progress bar | **None** |
| Transitions | Heart animation between dynamic screens |
| Fragment display | 8 visible immediately, 15 more via "More" button |

## Discovery Agent Prompt Design

This is the critical change from FO-07. The prompt must clearly explain the hybrid fragment concept with extensive examples.

### Generating Hybrid Fragments — Prompt Section

The following should be included in the discovery agent's system prompt:

---

```
## Generating Hybrid Fragments

Fragments help users articulate their feelings when they struggle to find words. Unlike simple labels ("work stress") or empty structures ("I keep worrying that..."), your fragments should SUGGEST A DIRECTION while INVITING COMPLETION.

### The Hybrid Fragment Principle

Your fragments should:
1. **Hint at common experiences** — normalize what the user might be feeling
2. **Suggest a direction** — give them something to react to
3. **Remain incomplete** — require them to add their specific situation
4. **Always end with "..."** — signal there's more to say

### What Makes a Good Hybrid Fragment

COMPARE these approaches:

| Type | Example | Why it works/fails |
|------|---------|-------------------|
| ❌ Chip (closed) | "self-doubt" | Too complete — user just selects, doesn't express |
| ❌ Pure structure | "I keep worrying that..." | Too open — no direction, user may feel stuck |
| ✅ Hybrid | "I keep doubting whether I'm..." | Suggests self-doubt, user completes WHAT they doubt |

MORE EXAMPLES:

❌ "feeling overwhelmed" (chip - closed)
❌ "What overwhelms me is..." (pure structure - no hint)
✅ "I feel overwhelmed by all the..." (hybrid - suggests overwhelm from quantity/load)
✅ "There's so much pressure to..." (hybrid - suggests external pressure)

❌ "fear of failure" (chip - closed)
❌ "I'm afraid that..." (pure structure - too open)
✅ "I'm afraid I'll..." (hybrid - suggests fear of outcome)
✅ "What if I'm not..." (hybrid - suggests inadequacy fear)
✅ "I keep thinking I'll mess up..." (hybrid - suggests performance anxiety)

### Fragment Examples by Dimension

Generate fragments relevant to the dimension you're exploring:

**EMOTIONAL BASELINE** (how they feel right now):
- "I've been feeling drained from..."
- "There's this heaviness when I think about..."
- "Lately I notice I feel most anxious about..."
- "I've been carrying this weight of..."
- "It's hard to shake this feeling of..."
- "I keep feeling like I'm..."
- "Most days I feel..."
- "I wake up feeling..."

**INNER DIALOGUE** (how they talk to themselves):
- "I catch myself thinking I should..."
- "Part of me believes I'm not..."
- "I keep comparing myself to..."
- "The voice in my head says I'm..."
- "I tell myself I need to..."
- "I keep doubting whether I'm..."
- "I worry others will see that I..."
- "I hold back because I think I'm..."

**NEEDS & LONGINGS** (what they want more/less of):
- "I wish I could feel more confident about..."
- "What I really need is to feel..."
- "I want to stop feeling like I have to..."
- "I'm craving more..."
- "I wish I didn't always..."
- "I want to believe that I can..."
- "I need to feel like I'm..."
- "I want to let go of..."

**BELIEVABILITY THRESHOLD** (what they can accept):
- "I could maybe believe that I..."
- "It feels hard to accept that I..."
- "I'm starting to think I might be..."
- "Part of me knows I'm..."
- "I want to trust that I..."
- "It would help to feel like I'm..."
- "I'm trying to believe that..."
- "Maybe I can accept that I..."

**LIFE CONTEXT** (where this shows up):
- "This comes up most when I'm at..."
- "I notice it especially in my..."
- "It affects how I..."
- "At work, I often feel..."
- "In my relationships, I tend to..."
- "When I'm alone, I..."
- "Around others, I feel like I..."
- "This is hardest when I'm..."

### Key Rules

1. **Always end with "..."** — signals incompleteness
2. **Suggest ONE direction per fragment** — don't overload
3. **Use natural, conversational language** — not clinical
4. **Vary the specificity** — some more open, some more directed
5. **Include 8 initial + 15 expanded** — gives user many options to find resonance
6. **Contextual relevance** — fragments should relate to what user has shared so far

### Output Format

{
  "reflectiveStatement": "string (empty on first screen)",
  "question": "string",
  "initialFragments": ["8 hybrid fragments..."],
  "expandedFragments": ["15 more hybrid fragments..."],
  "readyForAffirmations": false
}

### Example Output

**Context:** User selected "Confidence" and "Self-worth" topics. This is screen 2 (exploring Inner Dialogue).

{
  "reflectiveStatement": "It sounds like confidence is something you're working on.",
  "question": "What does that inner voice say when you doubt yourself?",
  "initialFragments": [
    "I catch myself thinking I'm not...",
    "Part of me believes I don't deserve...",
    "I keep comparing myself to...",
    "The voice in my head says I should...",
    "I worry others will see that I'm...",
    "I hold back because I think I'm...",
    "I tell myself I need to be more...",
    "I keep doubting whether I'm..."
  ],
  "expandedFragments": [
    "When things go well, I still feel like I...",
    "I'm afraid people will realize I'm...",
    "I struggle to accept that I'm...",
    "Deep down I believe I'm not...",
    "I keep waiting until I feel...",
    "I dismiss compliments because I think...",
    "I feel like I have to prove that I'm...",
    "I never feel like I'm enough when...",
    "I second-guess myself whenever I...",
    "I assume others are more...",
    "I feel like an imposter when...",
    "I can't shake the feeling that I'm...",
    "Even when I succeed, I think it was...",
    "I hold myself to standards that...",
    "I'm hardest on myself when..."
  ],
  "readyForAffirmations": false
}
```

---

### Prompt Changes Summary

| Section | Change |
|---------|--------|
| "Generating Chips" | Replace entirely with "Generating Hybrid Fragments" (above) |
| Output format | `initialChips` → `initialFragments` (8), `expandedChips` → `expandedFragments` (15) |
| Examples | Add extensive examples showing chip vs pure fragment vs hybrid |
| Dimension guidance | Add specific fragment examples for each of the 5 dimensions |

### Affirmation Agent

**No changes needed** — use FO-07's affirmation prompts (same as FO-04)

### Summary Agent

**Use FO-07's single summary agent** (not FO-06's pre/post pattern)

| Aspect | FO-06 | FO-07 / FO-08 |
|--------|-------|---------------|
| Pattern | Two agents: `pre-summary` (before generation) + `post-summary` (after) | Single `summary` agent |
| When shown | Pre-summary on loading screen, post-summary on completion | Summary on review screen (after affirmations generated) |
| Tense | Pre=future, Post=past | Present/past (affirmations already exist) |

FO-08 shows the summary at the top of the affirmation review screen, so only one summary agent is needed.

## File Structure

```
app/fo-08/
  page.tsx                      # From FO-06
  layout.tsx                    # From FO-06
  fo-08-layout-client.tsx       # From FO-06
  actions.ts                    # From FO-06 (modify: add reflectiveStatement validation)
  info/
    page.tsx                    # NEW: Info page describing FO-08 (see Info Page section)
  components/
    fo-experience.tsx           # From FO-06 (modify for new flow)
    step-welcome.tsx            # From FO-06 or FO-07
    step-familiarity.tsx        # From FO-06 or FO-07
    step-topics.tsx             # From FO-07 (FO-06 doesn't have this)
    step-dynamic.tsx            # From FO-06 (already uses fragments)
    fragment-input.tsx          # From FO-06 (modify: 8 visible, 15 via "More", no "Inspiration" link)
    heart-animation.tsx         # From FO-07
    affirmation-review.tsx      # From FO-07 (thumbs up/down)
    step-background.tsx         # From FO-06 or FO-07
    step-notifications.tsx      # From FO-06 or FO-07
    step-paywall.tsx            # From FO-06 or FO-07
    step-completion.tsx         # From FO-06 or FO-07

src/mastra/agents/fo-08/
  index.ts
  agent.ts                      # NEW: FO-07 framework + hybrid fragment generation
  affirmation-agent.ts          # From FO-07
  summary-agent.ts              # From FO-07

e2e/
  fo-08.test.ts                 # NEW: E2E test (copy from fo-07.test.ts, modify)
```

## Registration

FO-08 must be registered in three places:

### 1. Left Navigation Menu (`nav.config.ts`)

Add entry to `navTree` array:

```typescript
{
  label: "FO-08",
  href: "/fo-08",
  children: [
    { label: "Demo", href: "/fo-08" },
    { label: "Info", href: "/fo-08/info" },
  ],
},
```

### 2. Overview Page (`app/overview/page.tsx`)

Add entry to `versions` array:

```typescript
{
  id: 'FO-08',
  name: 'Hybrid Fragments',
  href: '/fo-08',
  tagline: 'Guided expression with direction',
  description: 'Combines FO-06 fragment mechanics with FO-07 discovery framework. Hybrid fragments suggest content direction while inviting personal completion.',
  inputType: 'Hybrid fragments',
  outputType: 'Thumbs up/down',
  highlight: 'Best of FO-06 + FO-07',
},
```

### 3. Info Page (`app/fo-08/info/page.tsx`)

Create info page using `InfoPageWrapper` component (copy structure from FO-07's info page):

- Summary box explaining hybrid fragments concept
- "Based on" section noting FO-06 (technical) + FO-07 (framework)
- Core Concept section with the hybrid fragment principle
- How It Works section with step-by-step flow
- Key Differences table comparing to FO-06 and FO-07
- Technical Details section

## KV Store Keys

```
versions.fo-08-discovery._info.default
versions.fo-08-discovery._model_name.default
versions.fo-08-discovery._temperature.default
versions.fo-08-discovery.system.default           # Modified for hybrid fragments
versions.fo-08-discovery.prompt.default

versions.fo-08-affirmation._info.default
versions.fo-08-affirmation._model_name.default
versions.fo-08-affirmation._temperature.default
versions.fo-08-affirmation.system.default         # Same as FO-07
versions.fo-08-affirmation.prompt.default         # Same as FO-07

versions.fo-08-summary._info.default
versions.fo-08-summary._model_name.default
versions.fo-08-summary._temperature.default
versions.fo-08-summary.system.default             # Same as FO-07
versions.fo-08-summary.prompt.default             # Same as FO-07
```

## Implementation Notes

1. **Copy FO-06 as technical base** — fragment mechanics already work
2. **Modify fragment-input.tsx:**

   Interface changes (FO-06 → FO-08):
   ```typescript
   // FO-06 current:
   initialFragments: string[];  // 5 fragments
   expandedFragments: string[]; // 8 more fragments

   // FO-08 updated:
   initialFragments: string[];  // 8 fragments (visible immediately)
   expandedFragments: string[]; // 15 more fragments (via "More" button)
   ```

   State changes:
   - Remove `showInspiration` state — fragments always visible
   - Keep `showMoreInspiration` state → rename to `showMore` for clarity

   UI changes:
   - Remove "Inspiration" link/button entirely
   - Show `initialFragments` (8) immediately on render
   - Rename "More Inspiration" button to "More"
   - Keep click-to-append behavior (removes "...", appends to textarea)
3. **Create new discovery agent** (`src/mastra/agents/fo-08/agent.ts`):
   - Base on FO-07's 5 Dimensions framework
   - Add hybrid fragment generation section from this spec
   - **Important:** Include full hybrid fragment prompt as `DEFAULT_INSTRUCTIONS`
     - This serves as fallback if KV store template not found
     - Should match the "Generating Hybrid Fragments" prompt section above
   - Update output format to expect 8 `initialFragments` + 15 `expandedFragments`
4. **Copy from FO-07:**
   - `affirmation-review.tsx` (thumbs up/down)
   - `heart-animation.tsx`
   - `step-topics.tsx` (FO-06 doesn't have topic selection)
   - Affirmation agent prompts
   - Summary agent prompts
5. **Modify actions.ts** — add `reflectiveStatement` support:
   - Update `DynamicScreenResponse` type to include `reflectiveStatement?: string`
   - Update `isValidDynamicScreenResponse` validation:
     - `reflectiveStatement` is optional (empty string on first screen)
     - When present, must be a string
   - Pass `reflectiveStatement` to `fragment-input.tsx` component
6. **Remove from FO-06:**
   - Progress bar
   - Swipe phase
   - "Inspiration" link (fragments visible immediately)
7. **Update fo-experience.tsx** — adjust step flow for FO-08's sequence

## Testing Strategy

**Principle:** Maximize automated testing during development. E2E testing is automated (not manual) and runs as the final verification step.

### Testing Phases

| Phase | Type | When |
|-------|------|------|
| 1. During Development | Component-level verification | After each component is built |
| 2. Integration | Verify components work together | After major features complete |
| 3. E2E (Automated) | Full flow verification | Final step before completion |

### 1. Development Testing (During Implementation)

Run the dev server and manually verify each component as you build it:

```bash
npm run dev  # Keep running during development
```

**Per-component checks:**
- `fragment-input.tsx` — Verify 8 fragments visible, "More" shows 15 more, click-to-append works
- `step-topics.tsx` — Verify topic selection and confetti
- `affirmation-review.tsx` — Verify thumbs up/down, Continue disabled until all rated
- `heart-animation.tsx` — Verify animation displays and auto-advances

### 2. Integration Testing

After major features are complete, verify the flow works end-to-end manually in the browser:
- Complete the full onboarding flow once
- Verify data passes correctly between screens
- Check console for errors

### 3. E2E Test (Automated — `e2e/fo-08.test.ts`)

**This is an automated test, not a manual task.** Copy FO-07's E2E test and modify.

| Test Area | What to Verify |
|-----------|----------------|
| Fragment display | 8 fragments visible immediately on dynamic screens (no "Inspiration" link) |
| More button | "More" button reveals 15 additional fragments |
| Fragment interaction | Clicking fragment removes "...", appends to textarea, focuses cursor |
| No progress bar | Verify no progress bar at any step |
| Heart animation | Heart animation appears between dynamic screens |
| Affirmation review | Thumbs up/down buttons work, all 10 must be rated |
| Continue button | Disabled until all 10 affirmations rated |
| Full flow | Welcome → Name → Familiarity → Topics → Dynamic screens → Review → Mockups → Completion |

**Commands:**
```bash
npm run db:seed                      # Populate KV store with FO-08 prompts (run once)
node --import tsx e2e/fo-08.test.ts  # Run automated E2E test
```

**E2E test must pass before implementation is considered complete.**

### AI Output Quality (Manual Review)

The only manual testing needed is reviewing AI-generated content quality. This cannot be automated.

Review AI output in 2-3 test sessions:

| Check | Pass Criteria |
|-------|---------------|
| Fragments end with "..." | All fragments incomplete |
| Hybrid structure | Each fragment suggests ONE direction |
| No closed chips | No single-word or phrase-only options |
| No pure structure | No fragments like "I feel..." without direction |
| Dimension relevance | Fragments match the dimension being explored |

### Regression Testing (Automated)

Run existing E2E tests to ensure FO-08 doesn't break other versions:

```bash
node --import tsx e2e/fo-06.test.ts  # Verify FO-06 still works
node --import tsx e2e/fo-07.test.ts  # Verify FO-07 still works
```

**Note:** FO-08 should have its own copy of modified components (fragment-input.tsx, etc.) to avoid affecting FO-06.

## Open Questions

- [x] Discovery framework: FO-07's 5 Dimensions
- [x] Reflective statements: Separate (FO-07 style)
- [x] Input mechanics: Hybrid fragments shown immediately
- [x] Fragment count: 8 initial + 15 expanded = 23 total
- [x] Affirmation selection: Thumbs up/down (FO-07)
- [x] Progress bar: None
- [x] Affirmation count: 10 at once
- [x] Welcome flow: Same as FO-07

## References

- **FO-06 (technical base):** Fragment UI mechanics, text area input, step-dynamic, actions.ts
- **FO-07 (framework base):** 5 Dimensions discovery, reflective statements, thumbs up/down review, heart animation, no progress bar
- **FO-04:** Affirmation prompts (shared with FO-07)
