# FO-07 Specification

**Created:** 2026-01-27
**Status:** Draft

## Overview

FO-07 is a UX prototype focused on refining the affirmation selection experience. The key change is replacing the swipe-based affirmation review with a card-based Like/Don't Like system where users rate all 20 affirmations before proceeding.

### Implementation Approach

- **Base version:** FO-04 (use its prompts, questions, and flow as the template)
- **Completely separate implementation:**
  - Separate Mastra agent (`fo-07-agent`)
  - Separate UI components in `app/fo-07/`
  - No shared dependencies with other FO versions beyond common utilities
- **Update info tab** for FO-07 with description of this version
- **Add FO-07 to overview screen** in the main app navigation
- **All prompts in KV store:**
  - Prompts must be added to the seed script
  - Prompts must be actively seeded before use
  - Agent reads prompts from KV store (not hardcoded)
- **E2E testing:** Automated Playwright tests (happy path through full flow)

### User Flow

1. **Intro Screen** (updated copy)
   - H1: "Choose what fits you best right now"
   - H2: "It doesn't have to be perfect."

2. **Discovery Screens** (topics, mood, time-of-day, etc.)
   - No progress bars
   - After each dynamic screen: pulsing heart transition (not confetti)
   - Reuse `HeartAnimation` component from FO-04

3. **Affirmation Review Screen** (replaces swipe experience)
   - Summary at top showing:
     - What we learned about the user (journey summary)
     - What types of affirmations were generated
   - 20 affirmation cards in a scrollable list
   - Each card contains:
     - Affirmation text
     - Thumbs up button (Like) - grey initially, **green** when selected
     - Thumbs down button (Don't Like) - grey initially, **red** when selected
   - No progress counter - keep it minimal
   - Continue button at **end of scrollable list** (not fixed)
   - Continue button disabled until ALL 20 cards are rated
   - "Liked" affirmations are kept, "Don't Liked" are discarded
   - Final set could be 13, 15, 19, etc. depending on choices

4. **Standard Onboarding Continues**
   - Theme choice
   - Notifications
   - Paywall
   - etc. (same as other FO versions)

### Pulsing Heart Animation

Reuse existing component from `app/fo-04/components/heart-animation.tsx`:
- Purple heart icon (w-20 h-20)
- Pulsing scale animation: 1 → 1.15 → 1 (1s loop)
- Message text below
- Auto-advances after 2.5s or tap to skip

## KV Store Prompts

New prompts for FO-07, based heavily on FO-04's quality and style:

| Key | Purpose |
|-----|---------|
| `versions.fo-07-discovery.system.default` | Discovery agent system prompt (based on FO-04) |
| `versions.fo-07-discovery.prompt.default` | Discovery prompt for generating dynamic screens |
| `versions.fo-07-affirmation.system.default` | Affirmation generation system prompt (based on FO-04) |
| `versions.fo-07-affirmation.prompt.default` | Generate 20 affirmations in a single call |
| `versions.fo-07-summary.system.default` | Summary generation (journey + affirmation types) |
| `versions.fo-07-summary.prompt.default` | Prompt for generating the combined summary |

## Testing Strategy

### E2E Test (Playwright)

**Approach:** Happy path test verifying the complete flow works end-to-end.

**Test scenarios:**
1. Navigate to `/fo-07`
2. Complete intro screen
3. Go through discovery screens (verify heart animation, no progress bar)
4. Reach Affirmation Review Screen with 20 cards
5. Rate all 20 cards using Like/Don't Like
6. Verify Continue button enables after all rated
7. Continue through standard onboarding (theme, notifications, paywall)
8. Reach completion screen

**Run with:** `node --import tsx e2e/fo-07.test.ts`

**Prerequisites:**
- `npm run db:seed` (to populate KV store with FO-07 prompts)
- Dev server running on localhost:3000

## Open Questions

- [x] Card presentation style → Scrollable list showing all 20 at once
- [x] Like/Don't Like behavior → Filtering mechanism; keeps liked, discards don't liked
- [x] After card review → Standard onboarding continues (theme, notifications, paywall)
- [x] Pulsing heart style → Reuse HeartAnimation from FO-04
- [x] Card design → Affirmation text + thumbs up/down buttons only
- [x] Progress indicator → None; Continue button activates when all rated
- [x] Base version → FO-04
- [x] Button colors → Grey initial, green for Like, red for Don't Like
- [x] Continue button position → End of scrollable list
- [x] Affirmation generation → Single API call for all 20
- [x] Summary content → Both journey summary + affirmation types generated

## References

- **FO-04 (base version):** `app/fo-04/` - prompts, questions, flow to imitate
- FO-04 HeartAnimation: `app/fo-04/components/heart-animation.tsx`
- FO-06 summary display: `app/fo-06/components/step-ready.tsx` - pattern for summary generation
- FO-06 E2E tests: `e2e/fo-06.test.ts` - pattern for automated testing
- KV store docs: `docs/current/keyvaluestore-and-template-engine.md`
- Overview page: `app/overview/page.tsx` - add FO-07 entry
- Info page pattern: `app/fo-04/info/page.tsx` - template for FO-07 info page
