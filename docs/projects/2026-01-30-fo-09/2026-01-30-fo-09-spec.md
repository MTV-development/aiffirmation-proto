# FO-09 Specification

**Created:** 2026-01-30
**Status:** Ready

## Braindump / introductory thoughts

Starting from FO-08 as base. Key changes:
- Remove reflective statements from discovery screens
- Keep the multi-choice topics step
- First discovery screen uses complete sentences instead of fragments (UX change: no "..." to remove)
- Subsequent discovery screens use FO-08's hybrid fragments
- Generate 5 affirmations at a time (not 10)
- Card-based one-at-a-time affirmation review with "Love it" / "Discard" buttons
- After reviewing 5, show chosen list with "I'm good with these" / "I want to create more"
- "I want more" generates another batch of 5, passing all liked/discarded for context and no-repeat instructions
- Unlimited cycles

## Overview

FO-09 builds on FO-08 with two key innovations:
1. **Two-stage discovery**: Complete sentences on the first screen (lower effort, broader exploration) followed by hybrid fragments on subsequent screens (deeper, more personal expression)
2. **Card-based affirmation curation**: Affirmations presented one at a time with "Love it" / "Discard" buttons, with unlimited "generate more" cycles until the user is satisfied

### Why This Change

| FO-08 Approach | Problem | FO-09 Solution |
|----------------|---------|----------------|
| Fragments on ALL discovery screens | First screen can feel demanding — user has to complete thoughts before they've warmed up | First screen uses complete sentences (lower friction), fragments come after |
| 20 affirmations rated in a list (thumbs up/down) | Reviewing a list of 20 feels like a chore; hard to give each one attention | One-at-a-time cards force focused evaluation |
| Single generation (2×10), must proceed | User may want more affirmations or different ones | Unlimited "generate more" cycles with feedback-informed generation |

## User Flow

### Welcome Phase (Same as FO-08)

| Step | Screen | Description |
|------|--------|-------------|
| 0 | Welcome | "The way you speak to yourself becomes the way you live!" |
| 1 | Name | "What should we call you?" |
| 2 | Personalized Welcome | "Welcome, {name}! Let us get to know you..." |
| 3 | Familiarity | "How familiar are you with affirmations?" (New / Some / Very) |
| 4 | Topics | Multi-select chips for areas of focus |

### Discovery Phase

#### Screen 1: Complete Sentences

The first discovery screen uses **complete sentences** instead of fragments. This lowers the barrier — the user just clicks sentences that resonate, without needing to complete a thought.

| Aspect | FO-09 Screen 1 |
|--------|-----------------|
| Question | Fixed opening question (same as FO-08) |
| Reflective statement | **None** |
| Input helpers | Complete sentences (NOT ending with "...") |
| Interaction | Click sentence → appends to text area as-is |
| Counts | 8 initial + 15 expanded via "More" button |

**UX difference from fragments:** Fragments remove trailing "..." before appending. Complete sentences have no "..." — they append as-is with a space separator. The user can click multiple sentences and/or type freely.

**Example complete sentences:**
- "I often feel anxious about my performance at work"
- "I compare myself to others and feel like I'm falling behind"
- "I struggle to believe compliments are genuine"
- "I put everyone else's needs before my own"

vs FO-08 fragments:
- "I often feel anxious about..."
- "I compare myself to..."
- "I struggle to believe..."

#### Screens 2+: Hybrid Fragments (FO-08 Style)

Subsequent discovery screens use FO-08's hybrid fragment approach for deeper exploration.

| Aspect | FO-09 Screens 2+ |
|--------|-------------------|
| Framework | FO-08's 5 Dimensions |
| Question | Agent-generated based on conversation |
| Reflective statement | **None** |
| Input helpers | Hybrid fragments (ending with "...") |
| Interaction | Click fragment → removes "...", appends to text area, cursor at end |
| Counts | 8 initial + 15 expanded via "More" button |
| Screen range | 2–5 dynamic screens (agent signals readyForAffirmations) |

### Affirmation Generation

| Aspect | FO-09 |
|--------|-------|
| Count per batch | **5** affirmations |
| Generation | Single call per batch |
| Feedback loop | Yes — subsequent batches include all liked/discarded + no-repeat instruction |

### Affirmation Review: Card-Based Curation

Affirmations are presented **one at a time** on cards. Each card shows:
- The affirmation text (centered, prominent)
- Two buttons: **"Love it"** and **"Discard"**

| Aspect | FO-09 |
|--------|-------|
| Presentation | One card at a time |
| Actions per card | "Love it" (keep) or "Discard" (skip) |
| Progress | Progress bar + "3/5" counter |
| Animation | Slide left transition between cards |
| No back button | Once decided, move to next card |

#### After Reviewing All 5 Cards

The user sees a **summary screen** listing all affirmations they "loved":

- List of kept affirmations
- Two buttons:
  - **"I'm good with these"** → proceed to post-review onboarding
  - **"I want to create more"** → generate another batch of 5

If the user has discarded all 5 (no loved affirmations), the summary screen adjusts:
- Message: "None of those resonated? Let's try again."
- Single button: **"Generate new affirmations"**

#### "I Want More" Cycle

When the user requests more affirmations:

1. Generate 5 new affirmations, passing:
   - All discovery context (same as first batch)
   - All **liked** affirmations so far (labeled "generate more like these")
   - All **discarded** affirmations so far (labeled "avoid similar patterns")
   - All **previous affirmations** combined (labeled "do not repeat these or close variations")
2. Present the 5 new affirmations as cards (same UI)
3. After reviewing, show updated summary (all liked affirmations across all batches)
4. Same two options: "I'm good with these" / "I want to create more"
5. **No limit** on cycles — user generates until satisfied
6. **Loading state:** Spinner with "Creating more affirmations..." message while generating

#### Affirmation Prompt — Feedback Section

For batches after the first, the affirmation prompt includes (following the established pattern from FO-02–FO-08):

```
## Feedback from Previous Batches

### Loved Affirmations (generate more like these):
- [list of all liked affirmations]

### Discarded Affirmations (avoid similar patterns):
- [list of all discarded affirmations]

### All Previous Affirmations (do not repeat these or close variations):
- [combined list of all generated affirmations]

Generate 5 NEW unique, personalized affirmations. Do NOT repeat or closely paraphrase any affirmation listed above.
```

### Post-Review Phase (Same as FO-08)

Triggered by "I'm good with these":

| Step | Screen |
|------|--------|
| Background | Visual personalization mockup |
| Notifications | Reminder preferences mockup |
| Paywall | Premium offering mockup |
| Completion | Shows all loved affirmations (accumulated across all batches) |

## Technical Approach

**Technical base:** FO-08

### Key Changes from FO-08

| Area | FO-08 | FO-09 |
|------|-------|-------|
| Discovery screen 1 | Hybrid fragments | Complete sentences |
| Reflective statements | Optional (agent-generated) | **Removed** |
| Affirmation count | 20 total (2×10) | **5 per batch, unlimited batches** |
| Affirmation review | List with thumbs up/down | **One-at-a-time cards with "Love it" / "Discard"** |
| Review requirement | Rate all 20, then continue | **Review all 5, then choose "done" or "more"** |
| Batch cycles | Single batch | **Unlimited cycles** |
| Feedback loop | Single batch (no feedback needed) | **Full feedback loop with liked/discarded/no-repeat** |
| Summary agent | Shown on review screen | **Not used** (no summary screen in card flow) |

## Discovery Agent Changes

### Screen 1: Complete Sentences Output

The agent generates complete sentences for screen 1. The JSON output uses the **same field names** (`initialFragments`/`expandedFragments`) as screens 2+ — the sentence-vs-fragment distinction is a prompt concern only. This avoids needing separate validation paths.

The `generateFirstScreenFragments` function signature is updated to accept **topics** in addition to name, so sentences are relevant to the user's selected areas of focus.

```json
{
  "question": "string (fixed opening question)",
  "initialFragments": ["8 complete sentences (no '...')"],
  "expandedFragments": ["15 more complete sentences (no '...')"],
  "readyForAffirmations": false
}
```

**Agent prompt section for complete sentences:**

```
## Generating Complete Sentences (First Screen Only)

On the first screen, generate COMPLETE SENTENCES that users can identify with.
Unlike fragments (which end with "..." and invite completion), these are
fully-formed statements describing common experiences.

### What Makes a Good Complete Sentence

- **Specific enough** to resonate: "I often feel anxious before important meetings" (not "I feel anxious")
- **Universal enough** to apply broadly: many people should see themselves in it
- **First person**: Always use "I" statements
- **Present tense**: Describes current experience
- **No ellipsis**: These are COMPLETE thoughts, not fragments

### Examples by Topic

**Confidence / Self-worth:**
- "I often feel like I'm not good enough compared to my peers"
- "I have trouble accepting compliments without dismissing them"
- "I hold myself to standards I would never expect from others"

**Stress / Anxiety:**
- "I lie awake at night replaying conversations in my head"
- "I feel overwhelmed by everything on my plate right now"
- "I have a hard time saying no even when I'm already stretched thin"

**Relationships:**
- "I worry that people only like me when I'm useful to them"
- "I tend to put everyone else's needs before my own"
- "I feel lonely even when I'm surrounded by people"
```

### Screens 2+: Hybrid Fragments Output (Same as FO-08)

```json
{
  "question": "string (agent-generated)",
  "initialFragments": ["8 hybrid fragments ending with '...'"],
  "expandedFragments": ["15 more hybrid fragments ending with '...'"],
  "readyForAffirmations": false
}
```

**No `reflectiveStatement` field** in either output format.

## UI/UX Details

| Aspect | FO-09 |
|--------|-------|
| Discovery progress bar | **None** |
| Card review progress bar | **Yes** — progress bar + "3/5" counter |
| Transitions | Heart animation between discovery screens |
| Discovery screen 1 | Complete sentences, click to append to text area |
| Discovery screens 2+ | Hybrid fragments, click removes "..." and appends |
| Affirmation cards | One at a time, slide-left transition, "Love it" / "Discard" buttons |
| Summary screen | Flat list of all loved affirmations (no batch distinction) + action buttons |

### Affirmation Card Design

Each card should be a centered, prominent presentation:
- **Progress bar** at top with **"3/5"** style counter (fills as user advances through cards)
- Large card with affirmation text
- Two buttons below the card:
  - **"Love it"** (positive action, primary styling)
  - **"Discard"** (neutral/secondary styling)
- **Slide-left transition**: current card slides out left, next slides in from right

### Summary Screen Design

After reviewing all 5 cards:
- Heading: "Your affirmations" (or similar)
- Flat list of all loved affirmations from current + previous batches (no batch distinction)
- Count indicator: "X affirmations collected"
- No minimum — user can proceed with even 1 loved affirmation
- Two action buttons:
  - **"I'm good with these"** (primary, proceeds to onboarding)
  - **"I want to create more"** (secondary, shows spinner + "Creating more affirmations..." then returns to card review)
- If no affirmations loved: adjusted messaging + single "Generate new" button

## File Structure

```
app/fo-09/
  page.tsx                      # From FO-08
  layout.tsx                    # From FO-08
  fo-09-layout-client.tsx       # From FO-08
  actions.ts                    # Modified: 5 affirmations, feedback loop, no reflective statement
  info/
    page.tsx                    # Info page describing FO-09
  components/
    fo-experience.tsx           # Modified for new flow (card review + cycle)
    step-welcome.tsx            # From FO-08
    step-familiarity.tsx        # From FO-08
    step-topics.tsx             # From FO-08
    step-dynamic.tsx            # Modified: screen 1 sentences vs screens 2+ fragments
    fragment-input.tsx          # Modified: mode prop ('sentences' | 'fragments') controls "..." removal
    heart-animation.tsx         # From FO-08
    affirmation-card.tsx        # NEW: single affirmation card with "Love it" / "Discard"
    affirmation-card-flow.tsx   # NEW: orchestrates card-by-card review of 5 affirmations
    affirmation-summary.tsx     # NEW: shows loved affirmations + "done" / "more" buttons
    step-background.tsx         # From FO-08
    step-notifications.tsx      # From FO-08
    step-paywall.tsx            # From FO-08
    step-completion.tsx         # From FO-08

src/mastra/agents/fo-09/
  index.ts
  agent.ts                      # Modified: complete sentences for screen 1, no reflective statement
  affirmation-agent.ts          # Modified: 5 affirmations, feedback loop support
  (no summary agent)            # Removed — not needed for card flow

e2e/
  fo-09.test.ts                 # E2E test
```

## Registration

### 1. Left Navigation Menu (`nav.config.ts`)

```typescript
{
  label: "FO-09",
  href: "/fo-09",
  children: [
    { label: "Demo", href: "/fo-09" },
    { label: "Info", href: "/fo-09/info" },
  ],
},
```

### 2. Overview Page (`app/overview/page.tsx`)

```typescript
{
  id: 'FO-09',
  name: 'Sentences + Card Curation',
  href: '/fo-09',
  tagline: 'Lower friction discovery, focused curation',
  description: 'Complete sentences on first discovery screen, hybrid fragments on subsequent screens. Card-based one-at-a-time affirmation review with unlimited "generate more" cycles.',
  inputType: 'Sentences → Fragments',
  outputType: 'Card curation (Love it / Discard)',
  highlight: 'Two-stage discovery + unlimited curation',
},
```

### 3. Info Page (`app/fo-09/info/page.tsx`)

Create info page using `InfoPageWrapper` component.

## KV Store Keys

```
versions.fo-09-discovery._info.default
versions.fo-09-discovery._model_name.default
versions.fo-09-discovery._temperature.default
versions.fo-09-discovery.system.default           # Modified: sentences for screen 1, no reflective statement
versions.fo-09-discovery.prompt.default

versions.fo-09-affirmation._info.default
versions.fo-09-affirmation._model_name.default
versions.fo-09-affirmation._temperature.default
versions.fo-09-affirmation.system.default         # Modified: 5 affirmations
versions.fo-09-affirmation.prompt.default         # With feedback template
versions.fo-09-affirmation.prompt.with_feedback   # Includes liked/discarded/no-repeat sections
```

## Implementation Notes

1. **Copy FO-08 as base** — most infrastructure carries over
2. **Remove reflective statement** from:
   - `DynamicScreenResponse` type
   - `isValidDynamicScreenResponse` validation
   - `fragment-input.tsx` rendering
   - Discovery agent output format
3. **Modify fragment-input.tsx** — add `mode` prop:
   - `mode: 'sentences' | 'fragments'` (default: `'fragments'`)
   - When `mode='sentences'`: click appends full text + space to text area (no "..." removal)
   - When `mode='fragments'`: click removes "...", appends cleaned text + space (existing behavior)
4. **Create affirmation-card.tsx**: Single card with affirmation text + two buttons
5. **Create affirmation-card-flow.tsx**: Manages the sequence of 5 cards, tracks loved/discarded
6. **Create affirmation-summary.tsx**: Shows collected affirmations + action buttons
7. **Modify fo-experience.tsx**: New flow state machine:
   - Welcome → Name → Welcome2 → Familiarity → Topics → Discovery → Card Review → (Summary → More Cards →)* → Post-Review
8. **Modify actions.ts**:
   - `generateAffirmations()`: generate 5 (not 10)
   - `generateMoreAffirmations()`: new action accepting liked/discarded arrays
   - Use established feedback pattern from FO-02–FO-08
9. **Modify discovery agent**: Two prompt modes, same output field names:
   - Screen 1: prompt requests complete sentences (no "..."), output uses `initialFragments` + `expandedFragments`
   - Screens 2+: prompt requests hybrid fragments (with "..."), output uses `initialFragments` + `expandedFragments`
10. **Modify `generateFirstScreenFragments`** — add `topics: string[]` parameter so screen 1 sentences are relevant to selected topics
11. **Remove summary agent** — not needed for card-based flow

## Testing Strategy

### E2E Test (`e2e/fo-09.test.ts`)

| Test Area | What to Verify |
|-----------|----------------|
| Screen 1 sentences | Complete sentences displayed (no "..."), click appends to text area |
| Screen 2+ fragments | Hybrid fragments with "...", click removes "..." and appends |
| No reflective statement | No reflective text on any discovery screen |
| No discovery progress bar | No progress bar during discovery phase |
| Card review progress bar | Progress bar with "3/5" counter during card review |
| Affirmation cards | 5 cards presented one at a time with slide-left transition |
| Card actions | "Love it" and "Discard" buttons work |
| Summary screen | Shows loved affirmations after 5 cards |
| "I'm good" flow | Proceeds to post-review onboarding |
| "I want more" flow | Generates new batch, returns to card review |
| Feedback loop | Subsequent batches include liked/discarded context |
| Full flow | Welcome → Name → Familiarity → Topics → Discovery → Cards → Summary → Onboarding |

```bash
npm run db:seed
node --import tsx e2e/fo-09.test.ts
```

### Regression

```bash
node --import tsx e2e/fo-08.test.ts  # Verify FO-08 still works
```

## Open Questions

- [x] Card animation: **Slide left** (current slides out left, next slides in from right)
- [x] Summary screen batch distinction: **No distinction** — flat list of all loved affirmations
- [x] Completion screen: **All loved affirmations** accumulated across all batches
- [x] Heart animation between discovery screens: **Keep**
- [x] Progress bar: **Card review only** (progress bar + "3/5" counter), none during discovery
- [x] Field names: **Same** (`initialFragments`/`expandedFragments`) for both sentences and fragments
- [x] Topics for screen 1: **Yes** — pass topics to `generateFirstScreenFragments`
- [x] Loading for "generate more": **Spinner + message** ("Creating more affirmations...")
- [x] Minimum loved count: **No minimum** — even 1 loved affirmation is sufficient to proceed

## References

- **FO-08 (base):** Hybrid fragments, 5 Dimensions, fragment-input mechanics
- **FO-06:** Fragment click-to-append behavior, swipe card precedent
- **FO-02–FO-06:** Feedback loop pattern (approved/skipped affirmations, no-repeat instructions)
